var Cidjy=function(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.fullClear=!0,this.clearColor="rgba(0,0,0,0.25)",this.children=[],this.totalChildren=0,this.mouseEvent=!1,this.mouseStyle=!0,this.mouse={x:void 0,y:void 0},this.scaleRatio=1};Cidjy.prototype.enableMouse=function(){var t=this;this.mouseEvent=!0,this.canvas.addEventListener("mousemove",function(i){t.mouse.x=i.offsetX,t.mouse.y=i.offsetY},!1),this.canvas.addEventListener("click",function(i){for(var e=0;e<t.children.length;e++)if(void 0!=t.children[e].events.click.callback&&t["mouseover"+t.children[e].type](t.children[e])){var i={target:t.children[e],type:"click"};t.children[e].events.click.callback(i)}},!1)},Cidjy.prototype.disableMouse=function(){this.mouseEvent=!1,this.canvas.removeEventListener("mousemove",function(t){var i=this.canvas.getBoundingClientRect();this.mouse.x=t.clientX-i.left,this.mouse.y=t.clientY-i.top},!1)},Cidjy.prototype.enableMouseStyle=function(){this.mouseStyle=!0},Cidjy.prototype.disableMouseStyle=function(){this.mouseStyle=!1},Cidjy.prototype.resize=function(t,i){if(window.devicePixelRatio>1){var e=this.canvas.width,o=this.canvas.height;this.canvas.width=e*window.devicePixelRatio,this.canvas.height=o*window.devicePixelRatio,this.canvas.style.width=e,this.canvas.style.height=o,this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio)}this.canvas.width=t,this.canvas.height=i},Cidjy.prototype.addChild=function(t){this.totalChildren++,t.uid=this.totalChildren,this.children.push(t)},Cidjy.prototype.removeChild=function(t){for(var i=0;i<this.children.length;i++)if(this.children[i].uid==t.uid){this.children.splice(i,1);break}},Cidjy.prototype.getChildIndex=function(t){for(var i=void 0,e=0;e<this.children.length;e++)if(this.children[e].uid==t.uid){i=e;break}return i},Cidjy.prototype.bringToFront=function(t){for(;this.getChildIndex(t)<this.children.length-1;)this.swapChildIndex(this.getChildIndex(t),this.getChildIndex(t)+1)},Cidjy.prototype.bringForward=function(t){this.getChildIndex(t)<this.children.length-1&&this.swapChildIndex(this.getChildIndex(t),this.getChildIndex(t)+1)},Cidjy.prototype.bringBackward=function(t){this.getChildIndex(t)>0&&this.swapChildIndex(this.getChildIndex(t),this.getChildIndex(t)-1)},Cidjy.prototype.sendToBack=function(t){for(;this.getChildIndex(t)>0;)this.swapChildIndex(this.getChildIndex(t),this.getChildIndex(t)-1)},Cidjy.prototype.swapChildIndex=function(t,i){return this.children.splice(i,0,this.children.splice(t,1)[0]),this},Cidjy.prototype.getMetName=function(t){console.log(this.drawRectangle)},Cidjy.prototype.empty=function(){for(;this.children.length>0;)this.children.pop()},Cidjy.prototype.render=function(){this.fullClear?this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight):(this.ctx.fillStyle=this.clearColor,this.ctx.fillRect(0,0,window.innerWidth,window.innerHeight));for(o=0;o<this.children.length;o++){var t=this.children[o];this.ctx.save(),void 0!=t.group&&(this.ctx.translate(t.group.x,t.group.y),this.ctx.rotate(Cidjy.degreeToRadian(t.group.rotation)),this.ctx.scale(t.group.scaleX,t.group.scaleY),this.ctx.globalAlpha=t.group.opacity),void 0!=t.mask&&(this.ctx.translate(t.mask.x,t.mask.y),this.ctx.rotate(Cidjy.degreeToRadian(t.mask.rotation)),this.ctx.scale(t.mask.scaleX,t.mask.scaleY),this.ctx.globalAlpha=t.mask.opacity,this["draw"+t.mask.type](t.mask),this.ctx.translate(-t.mask.x,-t.mask.y),this.ctx.clip()),this.ctx.translate(t.x,t.y),this.ctx.rotate(Cidjy.degreeToRadian(t.rotation)),this.ctx.scale(t.scaleX,t.scaleY),this.ctx.shadowBlur=t.shadowBlur,this.ctx.shadowColor=t.shadowColor,this.ctx.globalAlpha=t.opacity,this.ctx.globalCompositeOperation=t.blendMode,this["draw"+t.type](t),""!=t.fill&&(this.ctx.fillStyle=t.fill,this.ctx.fill()),""!=t.stroke&&(this.ctx.strokeStyle=t.stroke,this.ctx.lineWidth=t.strokeWidth,this.ctx.lineCap=t.lineCap,this.ctx.lineJoin=t.lineJoin,this.ctx.stroke()),this.ctx.translate(-t.x,-t.y),this.ctx.scale(1,1),this.ctx.rotate(-1*Cidjy.degreeToRadian(t.rotation)),this.ctx.restore()}if(this.mouseEvent){for(o=0;o<this.children.length;o++)if(void 0!=this.children[o].events.mouseover.callback){if(this["mouseover"+this.children[o].type](this.children[o])&&!this.children[o].events.mouseover.fired){i={target:this.children[o],type:"mouseover"};this.children[o].events.mouseover.fired=!0,this.children[o].events.mouseover.callback(i),this.children[o].events.mouseout.fired=!1}if(this.children[o].events.mouseover.fired&&!this.children[o].events.mouseout.fired&&!this["mouseover"+this.children[o].type](this.children[o])&&(this.children[o].events.mouseout.fired=!0,this.children[o].events.mouseover.fired=!1,void 0!=this.children[o].events.mouseout.callback)){var i={target:this.children[o],type:"mouseout"};this.children[o].events.mouseout.callback(i)}}for(var e=!1,o=0;o<this.children.length;o++)if((void 0!=this.children[o].events.mouseover.callback||void 0!=this.children[o].events.click.callback)&&this["mouseover"+this.children[o].type](this.children[o])){e=!0;break}this.mouseStyle&&(this.canvas.style.cursor=e?"pointer":"default")}},Cidjy.prototype.drawCube=function(t){this.ctx.beginPath(),this.ctx.rect(-t.width/2,-t.height/2,t.width,t.height),this.ctx.closePath()},Cidjy.prototype.drawRectangle=function(t){this.ctx.beginPath(),this.ctx.rect(-t.width/2,-t.height/2,t.width,t.height),this.ctx.closePath()},Cidjy.prototype.drawCircle=function(t){this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,2*Math.PI,!1),this.ctx.closePath()},Cidjy.prototype.drawPath=function(t){if(this.ctx.beginPath(),t.smoothed){if(t.smoothed)if(t.smooth(),t.closed){if(t.closed){this.ctx.moveTo(t.smoothedPoints[t.smoothPointsNumber].x,t.smoothedPoints[t.smoothPointsNumber].y);for(i=t.smoothPointsNumber+1;i<t.smoothedPoints.length-t.smoothPointsNumber;i++)this.ctx.lineTo(t.smoothedPoints[i].x,t.smoothedPoints[i].y)}}else{this.ctx.moveTo(t.smoothedPoints[0].x,t.smoothedPoints[0].y);for(i=1;i<t.smoothedPoints.length;i++)this.ctx.lineTo(t.smoothedPoints[i].x,t.smoothedPoints[i].y)}}else{this.ctx.moveTo(t.points[0].x,t.points[0].y);for(var i=1;i<t.points.length;i++)this.ctx.lineTo(t.points[i].x,t.points[i].y);t.closed&&this.ctx.closePath()}},Cidjy.prototype.drawRegularPolygon=function(t){this.drawPath(t.path)},Cidjy.prototype.drawArc=function(t){this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,Cidjy.degreeToRadian(t.startAngle),Cidjy.degreeToRadian(t.endAngle),t.antiClockwise),this.ctx.closePath()},Cidjy.prototype.drawImage=function(t){this.ctx.drawImage(t.img,-t.width/2,-t.height/2)},Cidjy.prototype.drawSprite=function(t){this.ctx.drawImage(t.img,t.width*t.currentFrame,0,t.width,t.height,-t.width/2,-t.height/2,t.width,t.height)},Cidjy.prototype.drawText=function(t){this.ctx.fillStyle=t.fill,this.ctx.font=t.fontStyle+" "+t.fontSize+" "+t.fontFamily,this.ctx.textAlign=t.textAlign,this.ctx.fillText(t.txt,0,0)},Cidjy.prototype.mouseoverCircle=function(t){return Cidjy.distanceBetween(t,this.mouse)<t.radius},Cidjy.prototype.mouseoverCube=function(t){return this.mouse.x>t.x-t.width/2&&this.mouse.x<t.x+t.width/2&&(this.mouse.y>t.y-t.height/2&&this.mouse.y<t.y+t.height/2)},Cidjy.prototype.mouseoverRectangle=function(t){return this.mouse.x>t.x-t.width/2&&this.mouse.x<t.x+t.width/2&&(this.mouse.y>t.y-t.height/2&&this.mouse.y<t.y+t.height/2)},Cidjy.prototype.mouseoverRegularPolygon=function(t){var i={x:this.mouse.x-t.x,y:this.mouse.y-t.y};return Cidjy.pointInPolygon(t.path.points,i)},Cidjy.prototype.mouseoverImage=function(t){return this.mouse.x>t.x-t.width/2&&this.mouse.x<t.x+t.width/2&&(this.mouse.y>t.y-t.height/2&&this.mouse.y<t.y+t.height/2)},Cidjy.prototype.mouseoverSprite=function(t){return this.mouse.x>t.x-t.width/2&&this.mouse.x<t.x+t.width/2&&(this.mouse.y>t.y-t.height/2&&this.mouse.y<t.y+t.height/2)},Cidjy.BaseShape=function(){this.uid=0,this.x=0,this.y=0,this.blendMode="source-over",this.rotation=0,this.scaleX=1,this.scaleY=1,this.opacity=1,this.fill="",this.stroke="",this.strokeWidth=1,this.lineCap="butt",this.lineJoin="miter",this.shadowBlur=0,this.shadowColor="#000",this.mask,this.group,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.BaseShape.prototype.addEventListener=function(t,i){void 0!=this.events[t]&&(this.events[t].fired=!1,this.events[t].callback=i)},Cidjy.Cube=function(t){this.type="Cube",this.width=t||50,this.height=t||50,this.size=t||50,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Cube.prototype=new Cidjy.BaseShape,Cidjy.Cube.prototype.setSize=function(t){void 0==t||null==t||isNaN(parseFloat(t))||(this.width=t,this.height=t,this.size=t)},Cidjy.Rectangle=function(t,i){this.type="Rectangle",this.width=t||150,this.height=i||100,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Rectangle.prototype=new Cidjy.BaseShape,Cidjy.Circle=function(t){this.type="Circle",this.radius=t||50,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Circle.prototype=new Cidjy.BaseShape,Cidjy.RegularPolygon=function(t,i){this.type="RegularPolygon",this.radius=t||50;for(var e=i||5,o=[],s=2*Math.PI/e,h=0;h<e;h++)o.push(new Cidjy.Point(this.radius*Math.sin(s*h),this.radius*Math.cos(s*h)));this.path=new Cidjy.Path(o),this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.RegularPolygon.prototype=new Cidjy.BaseShape,Cidjy.Image=function(t,i){var e=this;this.type="Image",this.src=t||"",this.loaded=!1,this.img=new Image,this.img.onload=function(){e.loaded=!0,e.width=e.img.width,e.height=e.img.height,void 0!=i&&i(e)},""!=this.src&&(this.img.src=this.src),this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Image.prototype=new Cidjy.BaseShape,Cidjy.Sprite=function(t,i,e,o,s,h,n){var r=this;this.type="Sprite",this.src=t||"",this.loaded=!1,this.img=new Image,this.frames=o,this.loop=h||!1,this.width=i,this.height=e,this.pWidth,this.pHeight,this.currentFrame=0,this.reverse=!1,this.fps=s||30,this.interval,this.img.onload=function(){r.loaded=!0,r.pWidth=r.img.width,r.pHeight=r.img.height,void 0!=n&&n(r)},""!=this.src&&(this.img.src=this.src),this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Sprite.prototype=new Cidjy.BaseShape,Cidjy.Sprite.prototype.nextFrame=function(){this.currentFrame<this.frames-1?this.currentFrame++:this.loop?this.currentFrame=0:this.stop()},Cidjy.Sprite.prototype.prevFrame=function(){this.currentFrame>0?this.currentFrame--:this.loop?this.currentFrame=this.frames-1:this.stop()},Cidjy.Sprite.prototype.render=function(){this.reverse?this.prevFrame():this.nextFrame()},Cidjy.Sprite.prototype.play=function(){var t=this;void 0==this.interval&&(this.interval=setInterval(function(){t.render()},1e3/this.fps))},Cidjy.Sprite.prototype.stop=function(){var t=this;clearInterval(t.interval),t.interval=void 0},Cidjy.Sprite.prototype.gotoAndPlay=function(t){t>-1&&t<this.frames-1&&(this.currentFrame=t,this.loop=!1,this.play())},Cidjy.Sprite.prototype.gotoAndStop=function(t){t>-1&&t<this.frames-1&&(this.currentFrame=t,this.loop=!1,this.stop())},Cidjy.Text=function(t,i){this.type="Text",this.txt=t,this.fontFamily=i.fontFamily||"Arial",this.fontSize=i.fontSize||"16px",this.fontStyle=i.fontStyle||"normal",this.textAlign=i.textAlign||"center",this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Text.prototype=new Cidjy.BaseShape,Cidjy.Path=function(t){this.type="Path",this.points=t,this.smoothedPoints,this.smoothed=!1,this.closed=!1,this.tension=.5,this.smoothPointsNumber=16,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Path.prototype=new Cidjy.BaseShape,Cidjy.Path.prototype.smooth=function(){var t=[];this.closed&&(t.push(this.points[this.points.length-1].x),t.push(this.points[this.points.length-1].y));for(e=0;e<this.points.length;e++)t.push(this.points[e].x),t.push(this.points[e].y);this.closed&&(t.push(this.points[0].x),t.push(this.points[0].y),t.push(this.points[1].x),t.push(this.points[1].y));var i=Cidjy.smoothPath(t,this.tension,!1,this.smoothPointsNumber);this.smoothedPoints=[];for(var e=0;e<i.length;e+=2)this.smoothedPoints.push(new Cidjy.Point(i[e],i[e+1]));this.smoothed=!0},Cidjy.Path.prototype.unSmooth=function(){this.smoothed=!1},Cidjy.Path.prototype.add=function(t){this.points.push(t)},Cidjy.Path.prototype.shuffle=function(t){for(var i=0;i<this.points.length;i++)this.points[i].moveRandom(t)},Cidjy.Arc=function(t,i,e,o){this.type="Arc",this.startAngle=t||0,this.endAngle=i||45,this.radius=e||50,this.antiClockwise=o||!1,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Arc.prototype=new Cidjy.BaseShape,Cidjy.Point=function(t,i){this.type="Point",this.x=t||0,this.y=i||0},Cidjy.Point.prototype.moveRandom=function(t){this.x+=Math.round(Math.random()*(2*t))-t,this.y+=Math.round(Math.random()*(2*t))-t},Cidjy.Group=function(){this.uid=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.opacity=1,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Cidjy.Group.prototype.add=function(t){t.group=this},Cidjy.Group.prototype.remove=function(t){t.group=void 0},Cidjy.smoothPath=function(t,i,e,o){i=void 0!==i?i:.5,e=e||!1,o=o||16;var s,h,n,r,d,a,c,l,u,p,y,m,f,v=[],g=[];for(v=t.slice(0),e?(v.unshift(v[v.length-1]),v.unshift(v[v.length-2]),v.unshift(v[v.length-1]),v.unshift(v[v.length-2]),v.push(v[0]),v.push(v[1])):(v.unshift(v[1]),v.unshift(v[0]),v.push(v[v.length-2]),v.push(v[v.length-1])),f=2;f<v.length-4;f+=2)for(m=0;m<=o;m++)n=(v[f+2]-v[f-2])*i,r=(v[f+4]-v[f])*i,d=(v[f+3]-v[f-1])*i,a=(v[f+5]-v[f+1])*i,y=m/o,c=2*Math.pow(y,3)-3*Math.pow(y,2)+1,l=-2*Math.pow(y,3)+3*Math.pow(y,2),u=Math.pow(y,3)-2*Math.pow(y,2)+y,p=Math.pow(y,3)-Math.pow(y,2),s=c*v[f]+l*v[f+2]+u*n+p*r,h=c*v[f+1]+l*v[f+3]+u*d+p*a,g.push(s),g.push(h);return g},Cidjy.degreeToRadian=function(t){return t*Math.PI/180},Cidjy.radianToDegree=function(t){return 180*t/Math.PI},Cidjy.distanceBetween=function(t,i){var e=0,o=0;return e=i.x-t.x,e*=e,o=i.y-t.y,o*=o,Math.sqrt(e+o)},Cidjy.pointInPolygon=function(t,i){for(var e=!1,o=-1,s=t.length,h=s-1;++o<s;h=o)(t[o].y<=i.y&&i.y<t[h].y||t[h].y<=i.y&&i.y<t[o].y)&&i.x<(t[h].x-t[o].x)*(i.y-t[o].y)/(t[h].y-t[o].y)+t[o].x&&(e=!e);return e};